{% extends 'app_general/components/base.html' %}

{% load static %}
{% block content %}
{% csrf_token %}
    <h1>Dash Board {{ user.username }}</h1>
    <h5>ข้อมูลผู้ใช้</h5>
     <form method="post" action="{% url 'profile' %}" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.non_field_errors }}
        <div style="margin-bottom:15px;">
            <div class="profile-image-wrapper"
                style="position: relative; width:150px; height:150px; border:2px dashed #ccc; border-radius:50%; overflow:hidden; display:flex; justify-content:center; align-items:center; background-color:#f8f8f8; cursor:pointer;"
                onclick="document.getElementById('id_profile_image').click();">

                {% if extended_form.instance.profile_image %}
                    <!-- ถ้ามีรูปเดิม แสดงรูปนี้ -->
                    <div id="profile-placeholder"
                        style="display:none; position:absolute; color:#888; font-size:14px; text-align:center;">
                        คลิกเพื่อเลือกภาพ
                    </div>
                    <img id="profile-preview"
                        src="{{ extended_form.instance.profile_image.url }}"
                        alt=""
                        style="width:100%; height:100%; object-fit:cover; display:block; filter: brightness(1);">
                {% else %}
                    <!-- ถ้าไม่มีรูปเดิม ซ่อน img แล้วโชว์ข้อความ -->
                    <img id="profile-preview"
                        alt=""
                        style="width:100%; height:100%; object-fit:cover; display:none;">
                    <div id="profile-placeholder"
                        style="position:absolute; color:#888; font-size:14px; text-align:center;">
                        คลิกเพื่อเลือกภาพ
                    </div>
                {% endif %}
            </div>
            {{ extended_form.profile_image }}
        </div>
            <script>
                const profileInput = document.getElementById("id_profile_image");
                const profilePreview = document.getElementById("profile-preview");
                const profilePlaceholder = document.getElementById("profile-placeholder");

                profileInput.addEventListener("change", function() {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            profilePreview.src = e.target.result;
                            profilePreview.style.display = "block";
                            profilePlaceholder.style.display = "none";
                        }
                        reader.readAsDataURL(file);
                    }
                });
            </script>
        <div style="margin-bottom:15px;">
            {{ form.first_name.label_tag }}
            {{ form.first_name }}
            {{ form.first_name.errors }}
        </div>
         <div style="margin-bottom:15px;">
            {{ form.last_name.label_tag }}
            {{ form.last_name }}
            {{ form.last_name.errors }}
        </div>
        <div style="margin-bottom:15px;">
            {{ extended_form.address.label_tag }}
            {{ extended_form.address }}
            {{ extended_form.address.errors }}
        </div>
        <div style="margin-bottom:15px;">
            {{ extended_form.phone.label_tag }}
            {{ extended_form.phone }}
            {{ extended_form.phone.errors }}
        </div>
       
            <button type="submit">Save</button>
    </form>  

{% endblock %}
